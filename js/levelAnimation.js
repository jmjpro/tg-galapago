LevelAnimation.CREATURE_DROPPING_INTERVAL=300;
LevelAnimation.BONFIRE_TIME_INTERVAL=2000;
LevelAnimation.BONFIRE_IMAGE_WIDTH=21;
LevelAnimation.BONFIRE_IMAGE_HEIGHT=36;
LevelAnimation.BOMB_TIME_INTERVAL=3500;
LevelAnimation.JUMP_TIME_INTERVAL=10;
LevelAnimation.ROLLOVER_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'}, 
 {cell: [46, 0], id: '2'}, 
 {cell: [92, 0], id: '3'}, 
 {cell: [138, 0], id: '4'}, 
 {cell: [184, 0], id: '5'}, 
 {cell: [230, 0], id: '6'}, 
 {cell: [276, 0], id: '7'}, 
 {cell: [322, 0], id: '8'}, 
 {cell: [368, 0], id: '9'}, 
 {cell: [414, 0], id: '10'}
 ]];

LevelAnimation.JUMP_SPRITE_MATRIX = [[
 {cell: [23, 0], id: '1'}, 
 {cell: [69, 0], id: '2'}, 
 {cell: [115, 0], id: '3'}, 
 {cell: [161, 0], id: '4'}, 
 {cell: [207, 0], id: '5'}, 
 {cell: [253, 0], id: '6'},
 {cell: [299, 0], id: '7'}, 
 {cell: [345, 0], id: '8'}, 
 {cell: [391, 0], id: '9'}, 
 {cell: [437, 0], id: '10'}, 
 {cell: [483, 0], id: '11'}, 
 {cell: [529, 0], id: '12'}, 
 {cell: [576, 0], id: '13'}, 
 {cell: [621, 0], id: '14'}
]];

LevelAnimation.BOMB_1_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [146, 0], id: '2'}, 
 {cell: [292, 0], id: '3'}, 
 {cell: [438, 0], id: '4'}, 
 {cell: [584, 0], id: '5'}, 
 {cell: [730, 0], id: '6'}, 
 {cell: [876, 0], id: '7'},
 {cell: [1022, 0], id: '8'}, 
 {cell: [1168, 0], id: '9'}, 
 {cell: [1314, 0], id: '10'}, 
 {cell: [1460, 0], id: '11'}, 
 {cell: [1606, 0], id: '12'}, 
 {cell: [1752, 0], id: '13'}, 
 {cell: [1898, 0], id: '14'}, 
 {cell: [2044, 0], id: '15'},
 {cell: [2190, 0], id: '16'}, 
 {cell: [2336, 0], id: '17'}, 
 {cell: [2482, 0], id: '18'}, 
 {cell: [2628, 0], id: '19'}, 
 {cell: [2774, 0], id: '20'}, 
 {cell: [2920, 0], id: '21'},
 {cell: [3066, 0], id: '22'}, 
 {cell: [3212, 0], id: '23'}, 
 {cell: [3358, 0], id: '24'}, 
 {cell: [3504, 0], id: '25'}, 
 {cell: [3650, 0], id: '26'}, 
 {cell: [3796, 0], id: '27'}, 
 {cell: [3942, 0], id: '28'}
 ]];

 LevelAnimation.BOMB_2_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [160, 0], id: '2'}, 
 {cell: [320, 0], id: '3'}, 
 {cell: [480, 0], id: '4'}, 
 {cell: [640, 0], id: '5'}, 
 {cell: [800, 0], id: '6'}, 
 {cell: [960, 0], id: '7'},
 {cell: [1120, 0], id: '8'}, 
 {cell: [1280, 0], id: '9'}, 
 {cell: [1440, 0], id: '10'}, 
 {cell: [1600, 0], id: '11'}, 
 {cell: [1760, 0], id: '12'}, 
 {cell: [1920, 0], id: '13'}, 
 {cell: [2080, 0], id: '14'}, 
 {cell: [2240, 0], id: '15'},
 {cell: [2400, 0], id: '16'}, 
 {cell: [2560, 0], id: '17'}, 
 {cell: [2720, 0], id: '18'}, 
 {cell: [2880, 0], id: '19'}, 
 {cell: [3040, 0], id: '20'}, 
 {cell: [3200, 0], id: '21'},
 {cell: [3360, 0], id: '22'}, 
 {cell: [3520, 0], id: '23'}, 
 {cell: [3680, 0], id: '24'}, 
 {cell: [3840, 0], id: '25'}, 
 {cell: [4000, 0], id: '26'}, 
 {cell: [4160, 0], id: '27'}, 
 {cell: [4320, 0], id: '28'}, 
 {cell: [4480, 0], id: '29'}, 
 {cell: [4640, 0], id: '30'}, 
 {cell: [4800, 0], id: '31'}, 
 {cell: [4960, 0], id: '32'}, 
 {cell: [5120, 0], id: '33'}, 
 {cell: [5280, 0], id: '34'}, 
 {cell: [5440, 0], id: '35'}
 ]];

LevelAnimation.BOMB_3_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [31, 0], id: '2'}, 
 {cell: [62, 0], id: '3'}, 
 {cell: [93, 0], id: '4'}, 
 {cell: [124, 0], id: '5'}, 
 {cell: [155, 0], id: '6'}, 
 {cell: [186, 0], id: '7'},
 {cell: [217, 0], id: '8'}, 
 {cell: [248, 0], id: '9'}, 
 {cell: [279, 0], id: '10'}, 
 {cell: [310, 0], id: '11'}, 
 {cell: [341, 0], id: '12'}, 
 {cell: [372, 0], id: '13'}, 
 {cell: [403, 0], id: '14'}, 
 {cell: [434, 0], id: '15'},
 {cell: [465, 0], id: '16'}, 
 {cell: [496, 0], id: '17'}, 
 {cell: [527, 0], id: '18'}, 
 {cell: [558, 0], id: '19'}, 
 {cell: [589, 0], id: '20'}, 
 {cell: [620, 0], id: '21'},
 {cell: [651, 0], id: '22'}
 ]];

LevelAnimation.BOMB_4_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [138, 0], id: '2'}, 
 {cell: [276, 0], id: '3'}, 
 {cell: [414, 0], id: '4'}, 
 {cell: [552, 0], id: '5'}, 
 {cell: [690, 0], id: '6'},
 {cell: [828, 0], id: '7'}, 
 {cell: [966, 0], id: '8'}, 
 {cell: [1104, 0], id: '9'}, 
 {cell: [1242, 0], id: '10'}, 
 {cell: [1380, 0], id: '11'}, 
 {cell: [1518, 0], id: '12'}, 
 {cell: [1656, 0], id: '13'}, 
 {cell: [1794, 0], id: '14'},
 {cell: [1932, 0], id: '15'}, 
 {cell: [2070, 0], id: '16'}, 
 {cell: [2208, 0], id: '17'}, 
 {cell: [2346, 0], id: '18'}, 
 {cell: [2484, 0], id: '19'}, 
 {cell: [2622, 0], id: '20'},
 {cell: [2760, 0], id: '21'}, 
 {cell: [2898, 0], id: '22'}, 
 {cell: [3036, 0], id: '23'}, 
 {cell: [3174, 0], id: '24'}, 
 {cell: [3312, 0], id: '25'}, 
 {cell: [3450, 0], id: '26'}, 
 {cell: [3588, 0], id: '27'}, 
 {cell: [3726, 0], id: '28'}, 
 {cell: [3864, 0], id: '29'}, 
 {cell: [4002, 0], id: '30'}, 
 {cell: [4140, 0], id: '31'}, 
 {cell: [4278, 0], id: '32'}
 ]];


LevelAnimation.BONFIRE_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'}, 
 {cell: [21, 0], id: '2'}, 
 {cell: [42, 0], id: '3'}, 
 {cell: [63, 0], id: '4'}, 
 {cell: [84, 0], id: '5'}, 
 {cell: [105, 0], id: '6'}, 
 {cell: [126, 0], id: '7'}, 
 {cell: [147, 0], id: '8'}, 
 {cell: [168, 0], id: '9'}, 
 {cell: [189, 0], id: '10'},
 {cell: [210, 0], id: '11'}, 
 {cell: [231, 0], id: '12'}, 
 {cell: [252, 0], id: '13'}, 
 {cell: [273, 0], id: '14'}, 
 {cell: [294, 0], id: '15'}, 
 {cell: [315, 0], id: '16'}
 ]];

LevelAnimation.GAME_START_ARROW_SPRITE_MATRIX = [[
{cell: [0, 0], id: '1'}, 
{cell: [27, 0], id: '2'}, 
{cell: [54, 0], id: '3'}, 
{cell: [81, 0], id: '4'}, 
{cell: [108, 0], id: '5'}, 
{cell: [135, 0], id: '6'}, 
{cell: [162, 0], id: '7'}, 
{cell: [189, 0], id: '8'}, 
{cell: [216, 0], id: '9'}
]];

LevelAnimation.POWER_ACHIEVED_SPRITE_MATRIX = [[
{cell: [0, 0], id: '1'}, 
{cell: [97, 0], id: '2'}, 
{cell: [194, 0], id: '3'}, 
{cell: [291, 0], id: '4'}, 
{cell: [388, 0], id: '5'}, 
{cell: [485, 0], id: '6'}, 
{cell: [582, 0], id: '7'}
]];

LevelAnimation.IDLE_HINT_SPRITE_MATRIX = [
[{cell: [0, 0], id: '1'}],
[{cell: [0, 36], id: '2'}],  
[{cell: [0, 72], id: '3'}], 
[{cell: [0, 108], id: '4'}],  
[{cell: [0, 144], id: '5'}],
[{cell: [0, 180], id: '6'}],   
[{cell: [0, 216], id: '7'}],
[{cell: [0, 252], id: '8'}],
[{cell: [0, 288], id: '9'}],
[{cell: [0, 324], id: '10'}],
[{cell: [0, 360], id: '11'}],
[{cell: [0, 396], id: '12'}],
[{cell: [0, 432], id: '13'}],
[{cell: [0, 468], id: '14'}],
[{cell: [0, 504], id: '15'}],
[{cell: [0, 540], id: '16'}],
[{cell: [0, 576], id: '17'}],
[{cell: [0, 612], id: '18'}]
];

LevelAnimation.BUBBLE_TIP_HINT_SPRITE_MATRIX = [
[{cell: [0, 0], id: '1'}],
[{cell: [0, 60], id: '2'}],  
[{cell: [0, 120], id: '3'}], 
[{cell: [0, 180], id: '4'}],  
[{cell: [0, 240], id: '5'}],
[{cell: [0, 300], id: '6'}],   
[{cell: [0, 360], id: '7'}]
];

LevelAnimation.BOB_CERVANTES_EYES_SPRITE_MATRIX = [[
{cell: [0, 0], id: '1'},
{cell: [202, 0], id: '2'},  
{cell: [404, 0], id: '3'}, 
{cell: [606, 0], id: '4'},  
{cell: [808, 0], id: '5'},
{cell: [1010, 0], id: '6'},   
{cell: [1212, 0], id: '7'},   
{cell: [1414, 0], id: '8'},   
{cell: [1616, 0], id: '9'},   
{cell: [1818, 0], id: '10'},   
{cell: [2020, 0], id: '11'},   
{cell: [2222, 0], id: '12'}
]];

LevelAnimation.BOB_CERVANTES_MOUTH_SPRITE_MATRIX = [[
{cell: [0, 0], id: '1'},
{cell: [202, 0], id: '2'},  
{cell: [404, 0], id: '3'}, 
{cell: [606, 0], id: '4'},  
{cell: [808, 0], id: '5'},
{cell: [1010, 0], id: '6'},   
{cell: [1212, 0], id: '7'} 
]];

LevelAnimation.SPARKLES_SPRITE_MATRIX = [
[{cell: [0, 0], id: '1'}],
[{cell: [0, 244], id: '2'}],  
[{cell: [0, 488], id: '3'}], 
[{cell: [0, 732], id: '4'}],  
[{cell: [0, 976], id: '5'}],
[{cell: [0, 1220], id: '6'}],   
[{cell: [0, 1464], id: '7'}],   
[{cell: [0, 1708], id: '8'}] 
];

LevelAnimation.sparklesImages = [];
function LevelAnimation(layer){
	this.rolloverAnimation = null;
	this.bonFireAnimation = null;
	this.bonFireParentAnimationInterval = null;
	this.bombAnimation = null;
	this.bombParentAnimationInterval = null;
	this.gameStartArrowAnimation = null;
	this.nextLevelArrowAnimatios = null;
	this.makeMatchAnimation = null;
	this.bobCervantesAnimation = null;
	this.sparklesAnimation = null;
}

LevelAnimation.prototype.initBobCervantes = function(layer) {
	var img, canvasBC, bcLeftHeadImageSpriteSheet, bcRightHeadImageSpriteSheet, bcMouthImageSpriteSheet, layerBobCervantes, imgLeftHeadEyes, imgRightHeadEyes, imgRightHeadMouth;
	img = LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "talking_heads_base.png");
	canvasBC = $('#layer-bob-cervantes');
	canvasBC[0].width = img.width;
	canvasBC[0].height = img.height;
	canvasBC.css('left','0px');
	canvasBC.css('top', '0px');
	layerBobCervantes = canvasBC[0].getContext('2d');
	layer.drawImage(img, 0, 0);
	bcLeftHeadImageSpriteSheet = new SpriteSheet(LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "talking_heads_left_head_eyes_strip.png"), LevelAnimation.BOB_CERVANTES_EYES_SPRITE_MATRIX);
	bcRightHeadImageSpriteSheet = new SpriteSheet(LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "talking_heads_right_head_eyes_strip.png"), LevelAnimation.BOB_CERVANTES_EYES_SPRITE_MATRIX);
	bcMouthImageSpriteSheet = new SpriteSheet(LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "talking_heads_mouth_strip.png"), LevelAnimation.BOB_CERVANTES_MOUTH_SPRITE_MATRIX);
	imgLeftHeadEyes = bcLeftHeadImageSpriteSheet.getSpriteNew([0,0]);
	imgLeftHeadEyes.onload =function() {
		layer.drawImage(imgLeftHeadEyes, 0, 0);
	}
	imgRightHeadEyes = bcRightHeadImageSpriteSheet.getSpriteNew([0,0]);
	imgRightHeadEyes.onload =function() {
		layer.drawImage(imgRightHeadEyes, 0, 0);		
	}
	imgRightHeadMouth = bcMouthImageSpriteSheet.getSpriteNew([0,0])
	imgRightHeadMouth.onload =function() {
		layer.drawImage(imgRightHeadMouth, 0, 0);
	}
	this.bobCervantesAnimation = new BobCervantesAnimation(layerBobCervantes, bcLeftHeadImageSpriteSheet, bcRightHeadImageSpriteSheet, bcMouthImageSpriteSheet);
}

LevelAnimation.prototype.animateBobCervantes = function(imageArray) {
	this.bobCervantesAnimation.start();
}

LevelAnimation.prototype.stopBobCervantes = function(imageArray) {
	this.bobCervantesAnimation.stop();
}

LevelAnimation.prototype.initImages = function(bgTheme, creatureTypes){
	var path, creatureTypeIt, image, creatureImagePaths, creatureType;
	path = "creatures/" + bgTheme + "/" ;
	for( creatureTypeIt = 0; creatureTypeIt < creatureTypes.length; creatureTypeIt++ ) {
			creatureType = creatureTypes[creatureTypeIt];
			image =  LoadingScreen.gal.get(path + creatureType + '_rollover.' + Level.BLOB_IMAGE_EXTENSION);
			this[creatureType + '_rollover'] = new SpriteSheet(image, LevelAnimation.ROLLOVER_SPRITE_MATRIX);
			image = LoadingScreen.gal.get(path + creatureType + '_jumps.' + Level.BLOB_IMAGE_EXTENSION);
			this[creatureType + '_jumps'] = new SpriteSheet(image, LevelAnimation.JUMP_SPRITE_MATRIX);
	}
	//console.debug('creatureImagePaths: ' + creatureImagePaths);
	return creatureImagePaths;
};

LevelAnimation.prototype.animateDroppingCreatures = function(animationQ){
	var deferred;
	deferred = Q.defer();
	if(animationQ.length){
		this.animateDropping(animationQ, deferred);
	}else{
		deferred.resolve();
	}
	return deferred.promise;
};

LevelAnimation.prototype.animateDropping= function(animationQ, deferred, cnt){
	var levelAnimation = this;
	if(cnt == animationQ.length){
		deferred.resolve();
	}else{
		if(!cnt){
			cnt = 0;
		} 
		Galapago.delay(LevelAnimation.CREATURE_DROPPING_INTERVAL).done(function(){
			var ele = animationQ[cnt];
			if(ele instanceof Array){
				_.each(ele,function(draw){
					draw();
				});
			}else{
				ele();
			}

			levelAnimation.animateDropping(animationQ, deferred, ++cnt);
		});
	}	
};

LevelAnimation.prototype.animateCreatureSelection = function(layer, board, markTile){
	var tileActive, imageId, rolloverImageSpriteSheet, tileMark, tileMarkImageSpriteSheet;
	if(this.rolloverAnimation){
		this.rolloverAnimation.stop();
		this.rolloverAnimation = null;
	}
	tileActive = board.tileActive;
	if(!tileActive.blob){
		return;
	}
	imageId = tileActive.blob.image.id.replace('_1','') + '_rollover';
	rolloverImageSpriteSheet = this[imageId];
	function stopCallback(){
		layer.clearRect(tileActive.getXCoord(), tileActive.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);
		layer.drawImage(tileActive.blob.image, tileActive.getXCoord(),tileActive.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);
		if(board.tileSelected == tileActive){
			tileActive.setSelectedAsync().then( function() {
				return;
			}).done();
		}
	}
	if(rolloverImageSpriteSheet){
		if(markTile){ 
			tileMark = LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + 'tile_mark_strip.png');
			tileMarkImageSpriteSheet = new SpriteSheet(tileMark, LevelAnimation.BUBBLE_TIP_HINT_SPRITE_MATRIX);
		}
		this.rolloverAnimation = new RolloverAnimation(layer, tileActive, rolloverImageSpriteSheet, stopCallback, tileMarkImageSpriteSheet);
		this.rolloverAnimation.start();
	}
};

LevelAnimation.prototype.animateCreaturesSwap = function(layer, board, tile, tilePrev, callback){
	var startedAnimation = false;
	if(this.rolloverAnimation){
		this.rolloverAnimation.stop();
		this.rolloverAnimation = null;
	}
		var tileDown, tileUp, tileUpSelected, tileUpDegreesToRotate, tileDownDegreesToRotate, width, height;			
		if(tilePrev.coordinates[1] > tile.coordinates[1]){
			tileDown = tilePrev;
			tileUp = tile;
			tileUpSelected = false;
			tileUpDegreesToRotate = CanvasUtil.UP_DIRECTION_DEGREE;
			width=46; 
			height=92;
		}
		if(tilePrev.coordinates[1] < tile.coordinates[1]){
			tileDown = tile;
			tileUp = tilePrev;
			tileUpSelected = true;
			tileUpDegreesToRotate = CanvasUtil.UP_DIRECTION_DEGREE;
			width=46; 
			height=92;
		}
		if(tilePrev.coordinates[0] > tile.coordinates[0]){
			tileDown = tilePrev;
			tileUp = tile;
			tileUpSelected = false;
			tileUpDegreesToRotate = CanvasUtil.LEFT_DIRECTION_DEGREE;
			tileDownDegreesToRotate = CanvasUtil.RIGHT_DIRECTION_DEGREE;
			width=92; 
			height=46;
		}
		if(tilePrev.coordinates[0] < tile.coordinates[0]){
			tileDown = tile;
			tileUp = tilePrev;
			tileUpSelected = true;
			tileUpDegreesToRotate = CanvasUtil.LEFT_DIRECTION_DEGREE;
			tileDownDegreesToRotate = CanvasUtil.RIGHT_DIRECTION_DEGREE;
			width=92; 
			height=46;
		}
		var imageId = tileDown.blob.image.id.replace('_1','') + '_jumps';
		var rolloverImageSpriteSheet = this[imageId];
		imageId = tileUp.blob.image.id.replace('_1','') + '_jumps';
		var rolloverImageSpriteSheet1 = this[imageId];
		var x = tileUp.getXCoord();
		var y = tileUp.getYCoord();
		if(rolloverImageSpriteSheet || rolloverImageSpriteSheet1){
			var imageArray = [];
			var imageArray1 = [];
			var imgCnt = 0;
			var image;
			for(imgCnt = 0;imgCnt < LevelAnimation.JUMP_SPRITE_MATRIX[0].length/4; imgCnt++){
				if(rolloverImageSpriteSheet){
					image = rolloverImageSpriteSheet.getSpriteNew([imgCnt * 4, 0], tileDownDegreesToRotate);
					imageArray.push(image);
				}
				if(rolloverImageSpriteSheet1){
					image = rolloverImageSpriteSheet1.getSpriteNew([imgCnt * 4, 0], tileUpDegreesToRotate);
					imageArray1.push(image);
				}
			}
			imgCnt = 0;
			var interval = setInterval(function(){
				var image1;
				if(rolloverImageSpriteSheet){
					image = imageArray[imgCnt];
				}
				if(rolloverImageSpriteSheet1){
					image1 = imageArray1[imgCnt];
				}
				layer.clearRect(x, y, width, height);
				if(tileUpSelected){
					if(image){
						layer.drawImage(image, x, y);
					}
					if(image1){
						layer.drawImage(image1, x, y);
					}
				}
				else{
					if(image1){
						layer.drawImage(image1, x, y);
					}
					if(image){
						layer.drawImage(image, x, y);
					}	
				}
				imgCnt++;
				if(imgCnt >= LevelAnimation.JUMP_SPRITE_MATRIX[0].length / 4){
					clearInterval(interval);
					//board.animateSwapCreaturesAsync( tile, tilePrev );
					callback();
				}
			}, LevelAnimation.JUMP_TIME_INTERVAL);
			startedAnimation = true;
		}
		if(!startedAnimation){
			callback();
		}
};

LevelAnimation.prototype.animateBonFire = function(completedLevelIds, highestCompletedId, layer){
	var levelAnimation = this;
	function animateRandomBornFires(){
		var coordinates = [];
		var bonfireImageSpriteSheet = new SpriteSheet(LoadingScreen.gal.get(MapScreen.GAL_PREFIX + 'strip_bonfire.png'), LevelAnimation.BONFIRE_SPRITE_MATRIX); 
		var animatedLevels = [];
		var parallelAnimation = Math.ceil( Math.random() * completedLevelIds.length);
		for (var i = 0; i < parallelAnimation; i++) {
			var randomLevelId;
			do{
				randomLevelId = Math.ceil( Math.random() * highestCompletedId);
			}while(_.contains(animatedLevels, randomLevelId) || !_.contains(completedLevelIds, randomLevelId));
			animatedLevels.push(randomLevelId);
		}
		_.each(animatedLevels, function(animatedLevel){
			var level = Level.findById(animatedLevel);
			var centroid = LevelAnimation.getMapHotspotRegionCentroid(level.mapHotspotRegion);
			var x = centroid[0] - Math.ceil(LevelAnimation.BONFIRE_IMAGE_WIDTH / 3);
			var y = centroid[1] - Math.ceil(LevelAnimation.BONFIRE_IMAGE_HEIGHT / 1.4);
			coordinates.push([x, y]);
		});
		if(coordinates.length){
			if(levelAnimation.bonFireAnimation){
				levelAnimation.bonFireAnimation.stop();
			}
			var bonFireAnimation = new BonFireAnimation(coordinates, bonfireImageSpriteSheet, layer);		
			bonFireAnimation.start();
			levelAnimation.bonFireAnimation = bonFireAnimation;
		}
	}
	animateRandomBornFires();
	this.bonFireParentAnimationInterval = setInterval(animateRandomBornFires, LevelAnimation.BONFIRE_TIME_INTERVAL);
}; //LevelAnimation.prototype.animateBonFire()

LevelAnimation.prototype.animateBombs = function(layer){
	var levelAnimation = this;
	function animateBomb(callback){
		var randomBombId = Math.ceil( Math.random() * 4);
		var coordinates, image, bombImageSpriteSheet;
		switch( randomBombId ) {
			case 1:
				image = LoadingScreen.gal.get(MapScreen.GAL_PREFIX + 'strip_bomb_left_one.png');
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_1_SPRITE_MATRIX); 
				coordinates = [556, 305 - image.height];
				break;
			case 2:
				image = LoadingScreen.gal.get(MapScreen.GAL_PREFIX + 'strip_bomb_left_two.png');
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_2_SPRITE_MATRIX); 
				coordinates = [546, 295 - image.height];
				break;
			case 3:
				image = LoadingScreen.gal.get(MapScreen.GAL_PREFIX + 'strip_bomb_mid.png');
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_3_SPRITE_MATRIX); 
				coordinates = [715, 386 - image.height];
				break;
			case 4:
				image = LoadingScreen.gal.get(MapScreen.GAL_PREFIX + 'strip_bomb_right.png');
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_4_SPRITE_MATRIX); 
				coordinates = [744 , 295 - image.height];
				break;
		} //switch( randomBombId ) {
		if(levelAnimation.bombAnimation){
			levelAnimation.bombAnimation.stop();
		}
		var bombAnimation = new BombAnimation(coordinates, bombImageSpriteSheet,layer,callback);		
		bombAnimation.start();
		levelAnimation.bombAnimation = bombAnimation;
	} //function animateBomb(callback)()
	animateBomb(animateBomb);
}; //LevelAnimation.prototype.animateBombs()

LevelAnimation.prototype.animateGameStartArrow = function(layer){
	var levelAnimation = this;
	function animateGameStartArrow(){
		var coordinates, image, gameStartArrowImageSpriteSheet;
		image = LoadingScreen.gal.get(MapScreen.GAL_PREFIX + 'strip_game_start_arrow.png');
		gameStartArrowImageSpriteSheet = new SpriteSheet(image, LevelAnimation.GAME_START_ARROW_SPRITE_MATRIX); 
		coordinates = [200 , 265 ];
		if(levelAnimation.gameStartArrowAnimation){
			levelAnimation.gameStartArrowAnimation.stop();
		}
		var gameStartArrowAnimation = new GameStartArrowAnimation(coordinates, gameStartArrowImageSpriteSheet,layer,animateGameStartArrow);		
		gameStartArrowAnimation.start();
		levelAnimation.gameStartArrowAnimation = gameStartArrowAnimation;
	}
	animateGameStartArrow();
};

LevelAnimation.prototype.stopGameStartArrow = function(){
	if(this.gameStartArrowAnimation){
		this.gameStartArrowAnimation.stop();
		this.gameStartArrowAnimation = null;
	}
};

/////
LevelAnimation.prototype.animatePowerAchieved = function(layer ,coordinates){
	var levelAnimation = this;
	var powerAchievedAnimation;
	var  image, powerAchievedImageSpriteSheet;
	image = LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "Powerup_ready_strip.png");
	powerAchievedImageSpriteSheet = new SpriteSheet(image, LevelAnimation.POWER_ACHIEVED_SPRITE_MATRIX); 
	powerAchievedAnimation = new GameStartArrowAnimation(coordinates, powerAchievedImageSpriteSheet,layer,animatePowerAchieved);	
	function animatePowerAchieved(){
		powerAchievedAnimation.start();
		if(!levelAnimation.powerAchievedAnimation){
			levelAnimation.powerAchievedAnimation = new Array();
		}
		levelAnimation.powerAchievedAnimation.push(powerAchievedAnimation);
	}
	animatePowerAchieved();
	return  powerAchievedAnimation;
	
}

LevelAnimation.prototype.stopPowerAchieved = function(powerAchievedAnimation){
	if(this.powerAchievedAnimation){
			var index = this.powerAchievedAnimation.indexOf(powerAchievedAnimation)
			this.powerAchievedAnimation[index].stop();
			//this.powerAchievedAnimation[index] = null;
			this.powerAchievedAnimation.splice( index, 1 );
	}
}

LevelAnimation.prototype.stopAllPowerAchieved = function(){
	if(this.powerAchievedAnimation){
			for (var i=0; i < this.powerAchievedAnimation.length; i++){
				this.powerAchievedAnimation[i].stop();
			}
	}
}
////

LevelAnimation.prototype.animateNextLevelArrows = function(layer, arrowInfo, arrowDirection){
	var nextLevelArrowAnimation = new NextLevelArrowAnimation(layer, arrowInfo);
	this.nextLevelArrowAnimation = nextLevelArrowAnimation;
	nextLevelArrowAnimation.start();
};

LevelAnimation.prototype.stopNextLevelArrows = function(){
	if(this.nextLevelArrowAnimation){
		this.nextLevelArrowAnimation.stop();
		this.nextLevelArrowAnimation = null;
	}
};

LevelAnimation.prototype.animateMakeMatch = function(layer, initialTile, swapTile){
	var image, imgCnt, validArray = true, imageArray = [];
	var image = LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "hint_strip.png");
	var rolloverImageSpriteSheet = new SpriteSheet(image, LevelAnimation.IDLE_HINT_SPRITE_MATRIX); 
	var tile,degreesToRotate;			
	if(initialTile.coordinates[1] > swapTile.coordinates[1]){
		tile = swapTile;
		degreesToRotate = CanvasUtil.LEFT_DIRECTION_DEGREE;
	}
	if(initialTile.coordinates[1] < swapTile.coordinates[1]){
		tile = initialTile;
		degreesToRotate = CanvasUtil.LEFT_DIRECTION_DEGREE;
	}
	if(initialTile.coordinates[0] > swapTile.coordinates[0]){
		tile = swapTile;
	}
	if(initialTile.coordinates[0] < swapTile.coordinates[0]){
		tile = initialTile;
	}
	if(degreesToRotate){
		if(!this.makeMatchVerticalSpritesArray){
			for(imgCnt = 0;imgCnt < LevelAnimation.IDLE_HINT_SPRITE_MATRIX.length; imgCnt++){
				image = rolloverImageSpriteSheet.getSpriteNew([0, imgCnt], degreesToRotate);
				if(!image.height){
					validArray = false;
				}
				imageArray.push(image);
			}
			if(validArray){
				this.makeMatchVerticalSpritesArray = imageArray;
			}
		}else{
			imageArray = this.makeMatchVerticalSpritesArray;
		}	 
	}else{
		if(!this.makeMatchHorizontalSpritesArray){
			for(imgCnt = 0;imgCnt < LevelAnimation.IDLE_HINT_SPRITE_MATRIX.length; imgCnt++){
				image = rolloverImageSpriteSheet.getSpriteNew([0, imgCnt]);
				if(!image.height){
					validArray = false;
				}
				imageArray.push(image);
			}
			if(validArray){
				this.makeMatchHorizontalSpritesArray = imageArray;
			}
		}else{
			imageArray = this.makeMatchHorizontalSpritesArray;
		}	 
	}
	var makeMatchAnimation = new MakeMatchAnimation(layer, initialTile, swapTile, imageArray, tile.getXCoord(), tile.getYCoord(), degreesToRotate);
	this.makeMatchAnimation = makeMatchAnimation;
	makeMatchAnimation.start();
};

LevelAnimation.prototype.stopMakeMatchAnimation = function(){
	if(this.makeMatchAnimation){
		this.makeMatchAnimation.stop();
		this.makeMatchAnimation = null;
	}
};

LevelAnimation.prototype.initSparkles = function() {
	if(!LevelAnimation.sparklesImages.length){
		var image = LoadingScreen.gal.get(Galapago.GAME_SCREEN_GAL_PREFIX + "creature_explosion_strip.png");
		var spriteSheet = new SpriteSheet(image, LevelAnimation.SPARKLES_SPRITE_MATRIX);
		for(var x = 0; x < LevelAnimation.SPARKLES_SPRITE_MATRIX.length; x++){
			LevelAnimation.sparklesImages.push(spriteSheet.getSpriteNew([0,x]));
		}
	}
}

LevelAnimation.prototype.animateSparkles = function(layer, x, y){
	var sparklesAnimation = new SparklesAnimation(layer, x, y);
	sparklesAnimation.start();
};

LevelAnimation.prototype.animateBoardBuild = function(creatureLayer, animationLayer, tileMatrix, callback){
	var boardBuildAnimation = new BoardBuildAnimation(creatureLayer, animationLayer, tileMatrix, callback);
	boardBuildAnimation.start();
}


LevelAnimation.prototype.stopAllAnimations = function(){
	if(this.rolloverAnimation){
		this.rolloverAnimation.stop();
		this.rolloverAnimation = null;
	}
	if(this.bonFireParentAnimationInterval){
		clearInterval(this.bonFireParentAnimationInterval);
	}
	if(this.bonFireAnimation){
		this.bonFireAnimation.stop();
		this.bonFireAnimation = null;
	}
	if(this.bombParentAnimationInterval){
		clearInterval(this.bombParentAnimationInterval);
	}
	if(this.bombAnimation){
		this.bombAnimation.stop();
		this.bombAnimation = null;
	}
	if(this.gameStartArrowAnimation){
		this.gameStartArrowAnimation.stop();
		this.gameStartArrowAnimation = null;
	}

	if(this.nextLevelArrowAnimation){
		this.nextLevelArrowAnimation.stop();
		this.nextLevelArrowAnimation = null;
	}
	if(this.makeMatchAnimation){
		this.makeMatchAnimation.stop();
		this.makeMatchAnimation = null;
	}
	if(this.bobCervantesAnimation){
		this.bobCervantesAnimation.stop();
		this.bobCervantesAnimation = null;
	}
};

LevelAnimation.getMapHotspotRegionCentroid = function(hotspotPointsArray){
	var minx =100000, miny=100000, maxx=0, maxy=0, x, y;
	_.each(hotspotPointsArray, function(hotspotPoint){
		minx = Math.min(minx, hotspotPoint[0]);
		maxx = Math.max(maxx, hotspotPoint[0]);
		miny = Math.min(miny, hotspotPoint[1]);
		maxy = Math.max(maxy, hotspotPoint[1]);
	});
	x = minx + Math.floor((maxx - minx) / 2);
	y = miny + Math.floor((maxy - miny) / 2);
	return [x,y];	
};

RolloverAnimation.ROLLOVER_TIME_INTERVAL=330;
function RolloverAnimation(layer, tileActive, rolloverImageSpriteSheet, stopCallback, tileMarkImageSpriteSheet){
	this.layer = layer;
	this.rolloverImageSpriteSheet = rolloverImageSpriteSheet;
	this.interval = null;
	this.rolloverSpriteId = 0;
	this.tileActive = tileActive;
	this.stopCallback = stopCallback;
	this.tileMarkImageSpriteSheet = tileMarkImageSpriteSheet;
	this.tileMarkSpriteId = 0;
}

RolloverAnimation.prototype.start = function(){
	this.rolloverSpriteId = 0;
	var rolloverAnimation = this;
	this.interval = setInterval(function() {
		rolloverAnimation.animate(rolloverAnimation);
	}, RolloverAnimation.ROLLOVER_TIME_INTERVAL);
};

RolloverAnimation.prototype.stop = function(){
	clearInterval(this.interval);
	this.stopCallback();
};

RolloverAnimation.prototype.animate = function(){
	var image = this.rolloverImageSpriteSheet.getSprite([this.rolloverSpriteId, 0]);
	this.layer.putImageData(image, this.tileActive.getXCoord(), this.tileActive.getYCoord());
	this.rolloverSpriteId += 2; //jj: testing a skip of the even sprites for performance reasons
	this.rolloverSpriteId = this.rolloverSpriteId % this.rolloverImageSpriteSheet.spriteMatrix[0].length;
	if(this.tileMarkImageSpriteSheet){
		image = this.tileMarkImageSpriteSheet.getSpriteNew([0, this.tileMarkSpriteId]);
		this.layer.drawImage(image, this.tileActive.getXCoord(), this.tileActive.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);
		this.tileMarkSpriteId++;
		this.tileMarkSpriteId = this.tileMarkSpriteId % this.tileMarkImageSpriteSheet.spriteMatrix.length;
	}
};

BonFireAnimation.ROLLOVER_TIME_INTERVAL=330;
function BonFireAnimation(coordinates, bonfireImageSpriteSheet, layer){
	this.bonfireImageSpriteSheet = bonfireImageSpriteSheet;
	this.interval = null;
	this.bonfireSpriteId = 0;
	this.coordinates = coordinates;
	this.layer = layer;
}

BonFireAnimation.prototype.start = function(){
	this.bonfireSpriteId = 0;
	var bonFireAnimation = this;
	this.interval = setInterval(function(){
		bonFireAnimation.animate();}, 
		BonFireAnimation.ROLLOVER_TIME_INTERVAL);
};

BonFireAnimation.prototype.stop = function(){
	clearInterval(this.interval);
	var bonFireAnimation = this;
	_.each(this.coordinates, function(coordinate){
		bonFireAnimation.layer.clearRect(coordinate[0], coordinate[1], LevelAnimation.BONFIRE_IMAGE_WIDTH,LevelAnimation.BONFIRE_IMAGE_HEIGHT);
	});
};

BonFireAnimation.prototype.animate = function(){
	var image = this.bonfireImageSpriteSheet.getSprite([this.bonfireSpriteId, 0]);
	var bonFireAnimation = this;
	_.each(this.coordinates, function(coordinate){
		bonFireAnimation.layer.putImageData(image, coordinate[0], coordinate[1]);
	});
	this.bonfireSpriteId++;
	this.bonfireSpriteId = this.bonfireSpriteId % LevelAnimation.BONFIRE_SPRITE_MATRIX[0].length;
};

BombAnimation.ROLLOVER_TIME_INTERVAL=100;
function BombAnimation(coordinates, bombImageSpriteSheet, layer, callback){
	this.bombImageSpriteSheet = bombImageSpriteSheet;
	this.interval = null;
	this.bombSpriteId = 0;
	this.coordinates = coordinates;
	this.layer = layer;
	this.callback = callback;
}

BombAnimation.prototype.start = function(){
	this.bombSpriteId = 0;
	var bombAnimation = this;
	this.interval = setInterval(function(){
		bombAnimation.animate();}, 
		BombAnimation.ROLLOVER_TIME_INTERVAL);
};

BombAnimation.prototype.stop = function(){
	if(this.interval){
		clearInterval(this.interval);
		var bombAnimation = this;
		bombAnimation.layer.clearRect(this.coordinates[0], this.coordinates[1], this.imageWidth, this.imageHeight);
	}
};

BombAnimation.prototype.animate = function(){
	var image = this.bombImageSpriteSheet.getSprite([this.bombSpriteId, 0]);
	this.imageHeight = image.height;
	this.imageWidth = image.width;
	this.layer.putImageData(image, this.coordinates[0], this.coordinates[1]);
	this.bombSpriteId++;
	if(this.bombSpriteId >= this.bombImageSpriteSheet.spriteMatrix[0].length){
		this.callback(this.callback);
	}
};

//

GameStartArrowAnimation.ROLLOVER_TIME_INTERVAL=100;
function GameStartArrowAnimation(coordinates, imageSpriteSheet, layer ,callback){
	this.imageSpriteSheet = imageSpriteSheet;
	this.interval = null;
	this.spriteId = 0;
	this.coordinates = coordinates;
	this.layer = layer;
	this.callback = callback;
}

GameStartArrowAnimation.prototype.start = function(){
	this.spriteId = 0;
	var animation = this;
	this.interval = setInterval(function(){
		animation.animate();},
		GameStartArrowAnimation.ROLLOVER_TIME_INTERVAL);
};

GameStartArrowAnimation.prototype.stop = function(){
	if(this.interval){
		clearInterval(this.interval);
		var animation = this;
		animation.layer.clearRect(this.coordinates[0], this.coordinates[1], this.imageWidth, this.imageHeight);
	}
};

GameStartArrowAnimation.prototype.animate = function(){
	var image = this.imageSpriteSheet.getSprite([this.spriteId, 0]);
	this.imageHeight = image.height;
	this.imageWidth = image.width;
	this.layer.putImageData(image, this.coordinates[0], this.coordinates[1]);
	this.spriteId++;
	if(this.spriteId >= this.imageSpriteSheet.spriteMatrix[0].length-1){
		//this.callback();
		this.spriteId=0;
	}
};

NextLevelArrowAnimation.ROLLOVER_TIME_INTERVAL=330;
function NextLevelArrowAnimation(layer, arrowsInfo){
	this.layer = layer;
	this.arrowsInfo = arrowsInfo;
	this.interval = null;
	this.rolloverSpriteId = 0;
}

NextLevelArrowAnimation.prototype.start = function(){
	this.rolloverSpriteId = 0;
	var rolloverAnimation = this;
	this.interval = setInterval(function(){
		rolloverAnimation.animate(rolloverAnimation);},
		RolloverAnimation.ROLLOVER_TIME_INTERVAL);
};

NextLevelArrowAnimation.prototype.stop = function(){
	clearInterval(this.interval);
	var nextLevelArrowAnimation = this;
	var arrowsInfo = nextLevelArrowAnimation.arrowsInfo;
	_.each(arrowsInfo, function(arrowInfo){
		nextLevelArrowAnimation.layer.clearRect(arrowInfo.xCoord, arrowInfo.yCoord, arrowInfo.image.width, arrowInfo.image.height);	
	});
};

NextLevelArrowAnimation.prototype.animate = function(){
	var nextLevelArrowAnimation = this;
	var arrowsInfo = nextLevelArrowAnimation.arrowsInfo;
	_.each(arrowsInfo, function(arrowInfo){
		if(nextLevelArrowAnimation.rolloverSpriteId == 1){
			nextLevelArrowAnimation.layer.clearRect(arrowInfo.xCoord, arrowInfo.yCoord, arrowInfo.image.width, arrowInfo.image.height);	
		}else{
			nextLevelArrowAnimation.layer.drawImage(arrowInfo.image, arrowInfo.xCoord, arrowInfo.yCoord);
		}
	});
	this.rolloverSpriteId++;
	this.rolloverSpriteId = this.rolloverSpriteId % 2;
};

MakeMatchAnimation.ROLLOVER_TIME_INTERVAL=100;
function MakeMatchAnimation(layer, initialTile, swapTile, imageArray, x, y, degreesToRotate){
	this.layer = layer;
	this.initialTile = initialTile;
	this.swapTile = swapTile;
	this.rolloverSpriteId = 0;
	this.imageArray = imageArray;
	this.x = x;
	this.y = y;
	this.degreesToRotate = degreesToRotate;
}

MakeMatchAnimation.prototype.start = function(){
	this.rolloverSpriteId = 0;
	var makeMatchAnimation = this;
	this.interval = setInterval(function(){
		makeMatchAnimation.animate();}, 
		MakeMatchAnimation.ROLLOVER_TIME_INTERVAL);
};

MakeMatchAnimation.prototype.stop = function(){
	this.layer.clearRect(this.initialTile.getXCoord(), this.initialTile.getYCoord(),Board.TILE_WIDTH, Board.TILE_HEIGHT);
	this.layer.drawImage(this.initialTile.blob.image, this.initialTile.getXCoord(),this.initialTile.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);
	this.layer.clearRect(this.swapTile.getXCoord(), this.swapTile.getYCoord(),Board.TILE_WIDTH, Board.TILE_HEIGHT);
	this.layer.drawImage(this.swapTile.blob.image, this.swapTile.getXCoord(),this.swapTile.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);
	clearInterval(this.interval);
};

MakeMatchAnimation.prototype.animate = function(){
	this.layer.clearRect(this.initialTile.getXCoord(), this.initialTile.getYCoord(),Board.TILE_WIDTH, Board.TILE_HEIGHT);
	this.layer.drawImage(this.initialTile.blob.image, this.initialTile.getXCoord(),this.initialTile.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);
	this.layer.clearRect(this.swapTile.getXCoord(), this.swapTile.getYCoord(),Board.TILE_WIDTH, Board.TILE_HEIGHT);
	this.layer.drawImage(this.swapTile.blob.image, this.swapTile.getXCoord(),this.swapTile.getYCoord(), Board.TILE_WIDTH, Board.TILE_HEIGHT);	
	var image = this.imageArray[this.rolloverSpriteId];
	this.layer.drawImage(image, this.x, this.y);
	this.rolloverSpriteId++;
	this.rolloverSpriteId = this.rolloverSpriteId % this.imageArray.length;
};

BoardBuildAnimation.ROLLOVER_TIME_INTERVAL=100;
BoardBuildAnimation.HEIGHT_OFFSET = 15;
function BoardBuildAnimation(creatureLayer, layer, tileMatrix, callback){
	this.creatureLayer = creatureLayer;
	this.layer = layer;
	this.tileMatrix = tileMatrix;
	this.noOfRows = 1;
	this.width = Board.TILE_WIDTH;
	this.height = Board.TILE_HEIGHT;
	this.callback = callback;
}

BoardBuildAnimation.prototype.start = function(){
	var boardBuildAnimation = this;
	this.interval = setInterval(function(){
		boardBuildAnimation.animate()}, 
		BoardBuildAnimation.ROLLOVER_TIME_INTERVAL);
};

BoardBuildAnimation.prototype.animate = function(){
	var col, row, tile, rowsToDisplay, complete;
	for(col = 0; col < this.tileMatrix.length; col++){
		if(this.noOfRows > this.tileMatrix[col].length){
			rowsToDisplay = this.tileMatrix[col].length;
		}else{
			rowsToDisplay = this.noOfRows;
		}
		for(row = 0; row < rowsToDisplay;row++){
			tile = this.tileMatrix[col][row];
			if(tile && tile.blob){
				y = LoadingScreen.STAGE_HEIGHT - BoardBuildAnimation.HEIGHT_OFFSET - (this.height * (this.noOfRows - row));
				if(y < tile.getYCoord()){
					complete = true;
					break;
				}
				this.layer.clearRect( tile.getXCoord(), y +  this.height , this.width, this.height );
				this.layer.drawImage(tile.blob.image, tile.getXCoord(), y, this.width, this.height);
			}
		}
		if(complete){
			break;
		}
	}
	if(complete){
		this.layer.clearRect( 0, 0, Board.GRID_WIDTH, Board.GRID_HEIGHT );
		for(col = 0; col < this.tileMatrix.length; col++){
			for(row = 0; row < this.tileMatrix[col].length; row++){
				tile = this.tileMatrix[col][row];
				if(tile && tile.blob){
					this.creatureLayer.drawImage(tile.blob.image, tile.getXCoord(), tile.getYCoord(), this.width, this.height);
				}
			}
		}
		clearInterval(this.interval);
		this.callback();
	}
	this.noOfRows++;
};

BobCervantesAnimation.ROLLOVER_TIME_INTERVAL=200;
function BobCervantesAnimation(layer, bcLeftHeadImageSpriteSheet, bcRightHeadImageSpriteSheet, bcMouthImageSpriteSheet){
	this.layer = layer;
	this.interval = null;
	this.eyeRolloverSpriteId = 0;
	this.mouthRolloverSpriteId = 0;
	this.bcLeftHeadImageArray = [];
	this.bcRightHeadImageArray = [];
	this.bcMouthImageArray= [];
	this.init(bcLeftHeadImageSpriteSheet, bcRightHeadImageSpriteSheet, bcMouthImageSpriteSheet);
}

BobCervantesAnimation.prototype.init = function(bcLeftHeadImageSpriteSheet, bcRightHeadImageSpriteSheet, bcMouthImageSpriteSheet){
	var image, imgCnt;
	for(imgCnt = 0;imgCnt < LevelAnimation.BOB_CERVANTES_EYES_SPRITE_MATRIX[0].length; imgCnt++){
		image = bcLeftHeadImageSpriteSheet.getSpriteNew([imgCnt, 0]);
		this.bcLeftHeadImageArray.push(image);
		image = bcRightHeadImageSpriteSheet.getSpriteNew([imgCnt, 0]);
		this.bcRightHeadImageArray.push(image);
	}
	for(imgCnt = 0;imgCnt < LevelAnimation.BOB_CERVANTES_MOUTH_SPRITE_MATRIX[0].length; imgCnt++){
		image = bcMouthImageSpriteSheet.getSpriteNew([imgCnt, 0]);
		this.bcMouthImageArray.push(image);
	}
}

BobCervantesAnimation.prototype.start = function(){
	if(this.interval){
		this.stop();
	}
	var bobCervantesAnimation = this;
	this.interval = setInterval(function() {
		bobCervantesAnimation.animate();
	}, BobCervantesAnimation.ROLLOVER_TIME_INTERVAL);
};

BobCervantesAnimation.prototype.stop = function(){
	if(this.interval){
		var image = this.bcRightHeadImageArray[0];
		this.layer.clearRect(0, 0, image.width, image.height);
		this.layer.drawImage(image, 0, 0);
		image = this.bcMouthImageArray[0];
		this.layer.drawImage(image, 0, 0);
		clearInterval(this.interval);
	}
};

BobCervantesAnimation.prototype.animate = function(){
	var image = this.bcRightHeadImageArray[this.eyeRolloverSpriteId];
	this.layer.clearRect(0, 0, image.width, image.height);
	this.layer.drawImage(image, 0, 0);
	image = this.bcMouthImageArray[this.mouthRolloverSpriteId];
	this.layer.drawImage(image, 0, 0);
	this.eyeRolloverSpriteId++;
	this.eyeRolloverSpriteId = this.eyeRolloverSpriteId % this.bcRightHeadImageArray.length;
	this.mouthRolloverSpriteId++;
	this.mouthRolloverSpriteId = this.mouthRolloverSpriteId % this.bcMouthImageArray.length;
};

SparklesAnimation.ROLLOVER_TIME_INTERVAL=100;
function SparklesAnimation(layer, x, y){
	this.layer = layer;
	this.interval = null;
	this.x = x;
	this.y = y;
	this.rolloverSpriteId = 0;
}

SparklesAnimation.prototype.start = function(){
	if(this.interval){
		this.stop();
	}
	this.x = this.x + (Board.TILE_WIDTH);
	this.y = this.y + (Board.TILE_HEIGHT);
	this.x = this.x - (LevelAnimation.sparklesImages[0].width/2);
	this.y = this.y - (LevelAnimation.sparklesImages[0].height/2);
	
	var sparklesAnimation = this;
	this.interval = setInterval(function() {
		sparklesAnimation.animate();
	}, SparklesAnimation.ROLLOVER_TIME_INTERVAL);
};

SparklesAnimation.prototype.stop = function(){
	if(this.interval){
		this.layer.clearRect(this.x,this.y, LevelAnimation.sparklesImages[0].width, LevelAnimation.sparklesImages[0].height);
		clearInterval(this.interval);
	}
};

SparklesAnimation.prototype.animate = function(){
	var image = LevelAnimation.sparklesImages[this.rolloverSpriteId];
	this.layer.clearRect(this.x,this.y, image.width, image.height);
	this.layer.drawImage(image, this.x, this.y);
	this.rolloverSpriteId++;
	if(this.rolloverSpriteId == LevelAnimation.sparklesImages.length){
		this.stop();
	}
};