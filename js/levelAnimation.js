LevelAnimation.CREATURE_DROPPING_INTERVAL=50;
LevelAnimation.BONFIRE_TIME_INTERVAL=2000;
LevelAnimation.BONFIRE_IMAGE_WIDTH=21;
LevelAnimation.BONFIRE_IMAGE_HEIGHT=36;
LevelAnimation.BOMB_TIME_INTERVAL=3500;
LevelAnimation.JUMP_TIME_INTERVAL=10;
LevelAnimation.ROLLOVER_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'}, 
 {cell: [46, 0], id: '2'}, 
 {cell: [92, 0], id: '3'}, 
 {cell: [138, 0], id: '4'}, 
 {cell: [184, 0], id: '5'}, 
 {cell: [230, 0], id: '6'}, 
 {cell: [276, 0], id: '7'}, 
 {cell: [322, 0], id: '8'}, 
 {cell: [368, 0], id: '9'}, 
 {cell: [414, 0], id: '10'}
 ]];

LevelAnimation.JUMP_SPRITE_MATRIX = [[
 {cell: [23, 0], id: '1'}, 
 {cell: [69, 0], id: '2'}, 
 {cell: [115, 0], id: '3'}, 
 {cell: [161, 0], id: '4'}, 
 {cell: [207, 0], id: '5'}, 
 {cell: [253, 0], id: '6'},
 {cell: [299, 0], id: '7'}, 
 {cell: [345, 0], id: '8'}, 
 {cell: [391, 0], id: '9'}, 
 {cell: [437, 0], id: '10'}, 
 {cell: [483, 0], id: '11'}, 
 {cell: [529, 0], id: '12'}, 
 {cell: [576, 0], id: '13'}, 
 {cell: [621, 0], id: '14'}
]];

LevelAnimation.BOMB_1_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [146, 0], id: '2'}, 
 {cell: [292, 0], id: '3'}, 
 {cell: [438, 0], id: '4'}, 
 {cell: [584, 0], id: '5'}, 
 {cell: [730, 0], id: '6'}, 
 {cell: [876, 0], id: '7'},
 {cell: [1022, 0], id: '8'}, 
 {cell: [1168, 0], id: '9'}, 
 {cell: [1314, 0], id: '10'}, 
 {cell: [1460, 0], id: '11'}, 
 {cell: [1606, 0], id: '12'}, 
 {cell: [1752, 0], id: '13'}, 
 {cell: [1898, 0], id: '14'}, 
 {cell: [2044, 0], id: '15'},
 {cell: [2190, 0], id: '16'}, 
 {cell: [2336, 0], id: '17'}, 
 {cell: [2482, 0], id: '18'}, 
 {cell: [2628, 0], id: '19'}, 
 {cell: [2774, 0], id: '20'}, 
 {cell: [2920, 0], id: '21'},
 {cell: [3066, 0], id: '22'}, 
 {cell: [3212, 0], id: '23'}, 
 {cell: [3358, 0], id: '24'}, 
 {cell: [3504, 0], id: '25'}, 
 {cell: [3650, 0], id: '26'}, 
 {cell: [3796, 0], id: '27'}, 
 {cell: [3942, 0], id: '28'}
 ]];

 LevelAnimation.BOMB_2_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [160, 0], id: '2'}, 
 {cell: [320, 0], id: '3'}, 
 {cell: [480, 0], id: '4'}, 
 {cell: [640, 0], id: '5'}, 
 {cell: [800, 0], id: '6'}, 
 {cell: [960, 0], id: '7'},
 {cell: [1120, 0], id: '8'}, 
 {cell: [1280, 0], id: '9'}, 
 {cell: [1440, 0], id: '10'}, 
 {cell: [1600, 0], id: '11'}, 
 {cell: [1760, 0], id: '12'}, 
 {cell: [1920, 0], id: '13'}, 
 {cell: [2080, 0], id: '14'}, 
 {cell: [2240, 0], id: '15'},
 {cell: [2400, 0], id: '16'}, 
 {cell: [2560, 0], id: '17'}, 
 {cell: [2720, 0], id: '18'}, 
 {cell: [2880, 0], id: '19'}, 
 {cell: [3040, 0], id: '20'}, 
 {cell: [3200, 0], id: '21'},
 {cell: [3360, 0], id: '22'}, 
 {cell: [3520, 0], id: '23'}, 
 {cell: [3680, 0], id: '24'}, 
 {cell: [3840, 0], id: '25'}, 
 {cell: [4000, 0], id: '26'}, 
 {cell: [4160, 0], id: '27'}, 
 {cell: [4320, 0], id: '28'}, 
 {cell: [4480, 0], id: '29'}, 
 {cell: [4640, 0], id: '30'}, 
 {cell: [4800, 0], id: '31'}, 
 {cell: [4960, 0], id: '32'}, 
 {cell: [5120, 0], id: '33'}, 
 {cell: [5280, 0], id: '34'}, 
 {cell: [5440, 0], id: '35'}
 ]];

LevelAnimation.BOMB_3_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [31, 0], id: '2'}, 
 {cell: [62, 0], id: '3'}, 
 {cell: [93, 0], id: '4'}, 
 {cell: [124, 0], id: '5'}, 
 {cell: [155, 0], id: '6'}, 
 {cell: [186, 0], id: '7'},
 {cell: [217, 0], id: '8'}, 
 {cell: [248, 0], id: '9'}, 
 {cell: [279, 0], id: '10'}, 
 {cell: [310, 0], id: '11'}, 
 {cell: [341, 0], id: '12'}, 
 {cell: [372, 0], id: '13'}, 
 {cell: [403, 0], id: '14'}, 
 {cell: [434, 0], id: '15'},
 {cell: [465, 0], id: '16'}, 
 {cell: [496, 0], id: '17'}, 
 {cell: [527, 0], id: '18'}, 
 {cell: [558, 0], id: '19'}, 
 {cell: [589, 0], id: '20'}, 
 {cell: [620, 0], id: '21'},
 {cell: [651, 0], id: '22'}
 ]];

LevelAnimation.BOMB_4_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'},
 {cell: [138, 0], id: '2'}, 
 {cell: [276, 0], id: '3'}, 
 {cell: [414, 0], id: '4'}, 
 {cell: [552, 0], id: '5'}, 
 {cell: [690, 0], id: '6'},
 {cell: [828, 0], id: '7'}, 
 {cell: [966, 0], id: '8'}, 
 {cell: [1104, 0], id: '9'}, 
 {cell: [1242, 0], id: '10'}, 
 {cell: [1380, 0], id: '11'}, 
 {cell: [1518, 0], id: '12'}, 
 {cell: [1656, 0], id: '13'}, 
 {cell: [1794, 0], id: '14'},
 {cell: [1932, 0], id: '15'}, 
 {cell: [2070, 0], id: '16'}, 
 {cell: [2208, 0], id: '17'}, 
 {cell: [2346, 0], id: '18'}, 
 {cell: [2484, 0], id: '19'}, 
 {cell: [2622, 0], id: '20'},
 {cell: [2760, 0], id: '21'}, 
 {cell: [2898, 0], id: '22'}, 
 {cell: [3036, 0], id: '23'}, 
 {cell: [3174, 0], id: '24'}, 
 {cell: [3312, 0], id: '25'}, 
 {cell: [3450, 0], id: '26'}, 
 {cell: [3588, 0], id: '27'}, 
 {cell: [3726, 0], id: '28'}, 
 {cell: [3864, 0], id: '29'}, 
 {cell: [4002, 0], id: '30'}, 
 {cell: [4140, 0], id: '31'}, 
 {cell: [4278, 0], id: '32'}
 ]];


LevelAnimation.BONFIRE_SPRITE_MATRIX = [[
 {cell: [0, 0], id: '1'}, 
 {cell: [21, 0], id: '2'}, 
 {cell: [42, 0], id: '3'}, 
 {cell: [63, 0], id: '4'}, 
 {cell: [84, 0], id: '5'}, 
 {cell: [105, 0], id: '6'}, 
 {cell: [126, 0], id: '7'}, 
 {cell: [147, 0], id: '8'}, 
 {cell: [168, 0], id: '9'}, 
 {cell: [189, 0], id: '10'},
 {cell: [210, 0], id: '11'}, 
 {cell: [231, 0], id: '12'}, 
 {cell: [252, 0], id: '13'}, 
 {cell: [273, 0], id: '14'}, 
 {cell: [294, 0], id: '15'}, 
 {cell: [315, 0], id: '16'}
 ]];

LevelAnimation.GAME_START_ARROW_SPRITE_MATRIX = [
[{cell: [0, 0], id: '1'}, 
{cell: [27, 0], id: '2'}, 
{cell: [54, 0], id: '3'}, 
{cell: [81, 0], id: '4'}, 
{cell: [108, 0], id: '5'}, 
{cell: [135, 0], id: '6'}, 
{cell: [162, 0], id: '7'}, 
{cell: [189, 0], id: '8'}, 
{cell: [216, 0], id: '9'}, 
{cell: [243, 0], id: '10'}],
];

LevelAnimation.GAME_IDLE_HINT_SPRITE_MATRIX = [
[{cell: [0, 3], id: '1'},
{cell: [60, 3], id: '2'},  
{cell: [120, 3], id: '3'}, 
{cell: [180, 3], id: '4'},  
{cell: [240, 3], id: '5'},
{cell: [300, 3], id: '6'},   
{cell: [360, 3], id: '7'}],
];

function LevelAnimation(layer){
	this.rolloverAnimation = null;
	this.bonFireAnimation = null;
	this.bonFireParentAnimationInterval = null;
	this.bombAnimation = null;
	this.bombParentAnimationInterval = null;
	this.gameStartArrowAnimation = null;
	this.nextLevelArrowAnimatios = null;
	this.makeMatchAnimation = null;
}

LevelAnimation.buildImagePaths = function(bgTheme, creatureTypes){
	var creatureTypeIt, creatureImagePathIt, creatureImagePath, creatureImagePaths, creatureType;
	creatureImagePaths = [];
	creatureImagePathIt = 0;
	for( creatureTypeIt = 0; creatureTypeIt < creatureTypes.length; creatureTypeIt++ ) {
			creatureType = creatureTypes[creatureTypeIt];
			creatureImagePath = Level.CREATURE_PATH + bgTheme + '/' + creatureType + '_rollover.' + Level.BLOB_IMAGE_EXTENSION;
			creatureImagePaths[creatureImagePathIt] = creatureImagePath;
			creatureImagePathIt++;
			creatureImagePath = Level.CREATURE_PATH + bgTheme + '/' + creatureType + '_jumps.' + Level.BLOB_IMAGE_EXTENSION;
			creatureImagePaths[creatureImagePathIt] = creatureImagePath;
			creatureImagePathIt++;
	}
	//console.debug('creatureImagePaths: ' + creatureImagePaths);
	return creatureImagePaths;
};

LevelAnimation.prototype.initImages = function(imageArray) {
	var levelAnimation;
	var imageId;
	levelAnimation = this;

	_.each(imageArray, function(image) {
		if(image.width > 0){
			imageId = image.id;
			if(imageId.indexOf('_rollover') > 0){
				levelAnimation[imageId] = new SpriteSheet(image, LevelAnimation.ROLLOVER_SPRITE_MATRIX);
			}
			if(imageId.indexOf('_jumps') > 0){
				levelAnimation[imageId] = new SpriteSheet(image, LevelAnimation.JUMP_SPRITE_MATRIX);
			}
		}
	});
};


LevelAnimation.prototype.animateDroppingCreatures = function(animationQ){
	var deferred;
	deferred = Q.defer();
	if(animationQ.length){
		this.animateDropping(animationQ, deferred);
	}else{
		deferred.resolve();
	}
	return 	deferred.promise;
}	

LevelAnimation.prototype.animateDropping= function(animationQ, deferred, cnt){
	var levelAnimation = this;
	if(cnt == animationQ.length){
		deferred.resolve();
	}else{
		if(!cnt){
			cnt = 0;
		} 
		Galapago.delay(LevelAnimation.CREATURE_DROPPING_INTERVAL).done(function(){
			animationQ[cnt]();
			levelAnimation.animateDropping(animationQ, deferred, ++cnt);
		});
	}	
}

LevelAnimation.prototype.animateCreatureSelection = function(layer, board){
	if(this.rolloverAnimation){
		this.rolloverAnimation.stop();
		this.rolloverAnimation = null;
	}
	var tileActive = board.tileActive;
	if(!tileActive.blob){
		return;
	}
	var imageId = tileActive.blob.image.id.replace('_1','') + '_rollover';
	var rolloverImageSpriteSheet = this[imageId];
	function stopCallback(){
		layer.clearRect(tileActive.getXCoord(), tileActive.getYCoord(), Tile.getWidth(), Tile.getHeight());
		layer.drawImage(tileActive.blob.image, tileActive.getXCoord(),tileActive.getYCoord(), Tile.getWidth(), Tile.getHeight());
		if(board.tileSelected == tileActive){
			tileActive.setSelectedAsync().then( function() {
				return;
			}).done();
		}
	}
	if(rolloverImageSpriteSheet){
		this.rolloverAnimation = new RolloverAnimation(layer, tileActive.getXCoord(),tileActive.getYCoord(), rolloverImageSpriteSheet, stopCallback);
		this.rolloverAnimation.start();
	}

};

LevelAnimation.prototype.animateCreaturesSwap = function(layer, board, tile, tilePrev, callback){
	var startedAnimation = false;
	if(this.rolloverAnimation){
		this.rolloverAnimation.stop();
		this.rolloverAnimation = null;
	}
		var tileDown, tileUp, tileUpSelected, tileUpDegreesToRotate, tileDownDegreesToRotate, width, height;			
		if(tilePrev.coordinates[1] > tile.coordinates[1]){
			tileDown = tilePrev;
			tileUp = tile;
			tileUpSelected = false;
			tileUpDegreesToRotate = CanvasUtil.UP_DIRECTION_DEGREE;
			width=46; 
			height=92;
		}
		if(tilePrev.coordinates[1] < tile.coordinates[1]){
			tileDown = tile;
			tileUp = tilePrev;
			tileUpSelected = true;
			tileUpDegreesToRotate = CanvasUtil.UP_DIRECTION_DEGREE;
			width=46; 
			height=92;
		}
		if(tilePrev.coordinates[0] > tile.coordinates[0]){
			tileDown = tilePrev;
			tileUp = tile;
			tileUpSelected = false;
			tileUpDegreesToRotate = CanvasUtil.LEFT_DIRECTION_DEGREE;
			tileDownDegreesToRotate = CanvasUtil.RIGHT_DIRECTION_DEGREE;
			width=92; 
			height=46;
		}
		if(tilePrev.coordinates[0] < tile.coordinates[0]){
			tileDown = tile;
			tileUp = tilePrev;
			tileUpSelected = true;
			tileUpDegreesToRotate = CanvasUtil.LEFT_DIRECTION_DEGREE;
			tileDownDegreesToRotate = CanvasUtil.RIGHT_DIRECTION_DEGREE;
			width=92; 
			height=46;
		}
		var imageId = tileDown.blob.image.id.replace('_1','') + '_jumps';
		var rolloverImageSpriteSheet = this[imageId];
		imageId = tileUp.blob.image.id.replace('_1','') + '_jumps';
		var rolloverImageSpriteSheet1 = this[imageId];
		var x = tileUp.getXCoord();
		var y = tileUp.getYCoord();
		if(rolloverImageSpriteSheet || rolloverImageSpriteSheet1){
			var width, height;
			var imageArray = [];
			var imageArray1 = [];
			var imgCnt = 0;
			for(imgCnt = 0;imgCnt < LevelAnimation.JUMP_SPRITE_MATRIX[0].length/2; imgCnt++){
				if(rolloverImageSpriteSheet){
					var image = rolloverImageSpriteSheet.getSpriteNew([imgCnt * 2, 0], tileDownDegreesToRotate);
					imageArray.push(image);
				}
				if(rolloverImageSpriteSheet1){
					var image = rolloverImageSpriteSheet1.getSpriteNew([imgCnt * 2, 0], tileUpDegreesToRotate);
					imageArray1.push(image);
				}	
			}
			imgCnt = 0;
			var interval = setInterval(function(){
				var image, image1;
				if(rolloverImageSpriteSheet){
					image = imageArray[imgCnt];
				}
				if(rolloverImageSpriteSheet1){
					image1 = imageArray1[imgCnt];
				}
				layer.clearRect(x, y, width, height);
				if(tileUpSelected){
					if(image){
						layer.drawImage(image, x, y);
					}
					if(image1){
						layer.drawImage(image1, x, y);
					}
				}
				else{
					if(image1){
						layer.drawImage(image1, x, y);
					}
					if(image){
						layer.drawImage(image, x, y);
					}	
				}
				imgCnt++;
				if(imgCnt == LevelAnimation.JUMP_SPRITE_MATRIX[0].length / 2){
					clearInterval(interval);
					//board.animateSwapCreaturesAsync( tile, tilePrev );
					callback();
				}
			}, LevelAnimation.JUMP_TIME_INTERVAL);
			startedAnimation = true;
		}
		if(!startedAnimation){
			callback();
		}
};

LevelAnimation.prototype.animateBonFire = function(completedLevelIds, highestCompletedId, layer){
	var levelAnimation = this;
	function animateRandomBornFires(){
		var coordinates = [];
		var bonfireImageSpriteSheet = new SpriteSheet(ScreenLoader.gal.get("map-screen/strip_bonfire.png"), LevelAnimation.BONFIRE_SPRITE_MATRIX); 
		var animatedLevels = [];
		var parallelAnimation = Math.ceil( Math.random() * completedLevelIds.length);
		for (var i = 0; i < parallelAnimation; i++) {
			var randomLevelId;
			do{
				randomLevelId = Math.ceil( Math.random() * highestCompletedId);
			}while(_.contains(animatedLevels, randomLevelId) || !_.contains(completedLevelIds, randomLevelId))
			animatedLevels.push(randomLevelId);
		};
		_.each(animatedLevels, function(animatedLevel){
			var level = Level.findById(animatedLevel);
			var centroid = LevelAnimation.getMapHotspotRegionCentroid(level.mapHotspotRegion);
			var x = centroid[0] - Math.ceil(LevelAnimation.BONFIRE_IMAGE_WIDTH / 3);
			var y = centroid[1] - Math.ceil(LevelAnimation.BONFIRE_IMAGE_HEIGHT / 1.4);
			coordinates.push([x, y]);
		});
		if(coordinates.length){
			if(levelAnimation.bonFireAnimation){
				levelAnimation.bonFireAnimation.stop();
			}
			var bonFireAnimation = new BonFireAnimation(coordinates, bonfireImageSpriteSheet, layer);		
			bonFireAnimation.start();
			levelAnimation.bonFireAnimation = bonFireAnimation;
		}
	}
	animateRandomBornFires();
	this.bonFireParentAnimationInterval = setInterval(animateRandomBornFires, LevelAnimation.BONFIRE_TIME_INTERVAL);
}

LevelAnimation.prototype.animateBombs = function(layer){
	var levelAnimation = this;
	function animateBomb(callback){
		var randomBombId = Math.ceil( Math.random() * 4);
		var coordinates, image, bombImageSpriteSheet;
		switch( randomBombId ) {
			case 1:
				image = ScreenLoader.gal.get("map-screen/strip_bomb_left_one.png");
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_1_SPRITE_MATRIX); 
				coordinates = [556, 305 - image.height];
				break;
			case 2:
				image = ScreenLoader.gal.get("map-screen/strip_bomb_left_two.png");
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_2_SPRITE_MATRIX); 
				coordinates = [546, 295 - image.height];
				break;
			case 3:
				image = ScreenLoader.gal.get("map-screen/strip_bomb_mid.png");
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_3_SPRITE_MATRIX); 
				coordinates = [715, 386 - image.height];
				break;
			case 4:
				image = ScreenLoader.gal.get("map-screen/strip_bomb_right.png");
				bombImageSpriteSheet = new SpriteSheet(image, LevelAnimation.BOMB_4_SPRITE_MATRIX); 
				coordinates = [744 , 295 - image.height];
				break;
		}
		if(levelAnimation.bombAnimation){
			levelAnimation.bombAnimation.stop();
		}
		var bombAnimation = new BombAnimation(coordinates, bombImageSpriteSheet,layer,callback);		
		bombAnimation.start();
		levelAnimation.bombAnimation = bombAnimation;
	};
	animateBomb(animateBomb);
}

LevelAnimation.prototype.animateGameStartArrow = function(layer){
	var levelAnimation = this;
	function animateGameStartArrow(){
		var coordinates, image, gameStartArrowImageSpriteSheet;
		image = ScreenLoader.gal.get("map-screen/strip_game_start_arrow.png");
		gameStartArrowImageSpriteSheet = new SpriteSheet(image, LevelAnimation.GAME_START_ARROW_SPRITE_MATRIX); 
		coordinates = [200 , 265 ];
		if(levelAnimation.gameStartArrowAnimation){
			levelAnimation.gameStartArrowAnimation.stop();
		}
		var gameStartArrowAnimation = new GameStartArrowAnimation(coordinates, gameStartArrowImageSpriteSheet,layer,animateGameStartArrow);		
		gameStartArrowAnimation.start();
		levelAnimation.gameStartArrowAnimation = gameStartArrowAnimation;
	}
	animateGameStartArrow();
}

LevelAnimation.prototype.stopGameStartArrow = function(){
	if(this.gameStartArrowAnimation){
		this.gameStartArrowAnimation.stop();
		this.gameStartArrowAnimation = null;
	}
}

LevelAnimation.prototype.animateNextLevelArrows = function(layer, arrowInfo, arrowDirection){
	var nextLevelArrowAnimation = new NextLevelArrowAnimation(layer, arrowInfo);
	this.nextLevelArrowAnimation = nextLevelArrowAnimation;
	nextLevelArrowAnimation.start();
}

LevelAnimation.prototype.stopNextLevelArrows = function(){
	if(this.nextLevelArrowAnimation){
		this.nextLevelArrowAnimation.stop();
		this.nextLevelArrowAnimation = null;
	}
}

LevelAnimation.prototype.animateMakeMatch = function(layer, initialTile, swapTile){
	var image = ScreenLoader.gal.get("game-screen/tile_mark_strip.png");
	var rolloverImageSpriteSheet = new SpriteSheet(image, LevelAnimation.GAME_IDLE_HINT_SPRITE_MATRIX); 
	var makeMatchAnimation = new MakeMatchAnimation(layer, initialTile, swapTile, rolloverImageSpriteSheet);
	this.makeMatchAnimation = makeMatchAnimation;
	makeMatchAnimation.start();
}

LevelAnimation.prototype.stopMakeMatchAnimation = function(layer, initialTile, swapTile){
	if(this.makeMatchAnimation){
		this.makeMatchAnimation.stop();
		this.makeMatchAnimation = null;
	}
}

LevelAnimation.prototype.stopAllAnimations = function(){
	if(this.rolloverAnimation){
		this.rolloverAnimation.stop();
		this.rolloverAnimation = null;
	}
	if(this.bonFireParentAnimationInterval){
		clearInterval(this.bonFireParentAnimationInterval);
	}
	if(this.bonFireAnimation){
		this.bonFireAnimation.stop();
		this.bonFireAnimation = null;
	}
	if(this.bombParentAnimationInterval){
		clearInterval(this.bombParentAnimationInterval);
	}
	if(this.bombAnimation){
		this.bombAnimation.stop();
		this.bombAnimation = null;
	}
	if(this.gameStartArrowAnimation){
		this.gameStartArrowAnimation.stop();
		this.gameStartArrowAnimation = null;
	}
	if(this.nextLevelArrowAnimation){
		this.nextLevelArrowAnimation.stop();
		this.nextLevelArrowAnimation = null;
	}
	if(this.makeMatchAnimation){
		this.makeMatchAnimation.stop();
		this.makeMatchAnimation = null;
	}
}

LevelAnimation.getMapHotspotRegionCentroid = function(hotspotPointsArray){
	var minx =100000, miny=100000, maxx=0, maxy=0, x, y;
	_.each(hotspotPointsArray, function(hotspotPoint){
		minx = Math.min(minx, hotspotPoint[0]);
		maxx = Math.max(maxx, hotspotPoint[0]);
		miny = Math.min(miny, hotspotPoint[1]);
		maxy = Math.max(maxy, hotspotPoint[1]);
	});
	x = minx + Math.floor((maxx - minx) / 2);
	y = miny + Math.floor((maxy - miny) / 2);
	return [x,y];	
}

RolloverAnimation.ROLLOVER_TIME_INTERVAL=330;
function RolloverAnimation(layer, xCoord, yCoord, rolloverImageSpriteSheet, stopCallback){
	this.layer = layer;
	this.rolloverImageSpriteSheet = rolloverImageSpriteSheet;
	this.interval = null;
	this.rolloverSpriteId = 0;
	this.xCoord = xCoord;
	this.yCoord = yCoord;
	this.stopCallback = stopCallback;
}

RolloverAnimation.prototype.start = function(){
	this.rolloverSpriteId = 0;
	var rolloverAnimation = this;
	this.interval = setInterval(function(){
		rolloverAnimation.animate(rolloverAnimation)}, 
		RolloverAnimation.ROLLOVER_TIME_INTERVAL);
};

RolloverAnimation.prototype.stop = function(){
	clearInterval(this.interval);
	this.stopCallback();
};

RolloverAnimation.prototype.animate = function(){
	var image = this.rolloverImageSpriteSheet.getSprite([this.rolloverSpriteId, 0]);
	this.layer.putImageData(image, this.xCoord, this.yCoord);
	this.rolloverSpriteId++;
	this.rolloverSpriteId = this.rolloverSpriteId % this.rolloverImageSpriteSheet.spriteMatrix[0].length;
};

BonFireAnimation.ROLLOVER_TIME_INTERVAL=330;
function BonFireAnimation(coordinates, bonfireImageSpriteSheet, layer){
	this.bonfireImageSpriteSheet = bonfireImageSpriteSheet;
	this.interval = null;
	this.bonfireSpriteId = 0;
	this.coordinates = coordinates;
	this.layer = layer;
}

BonFireAnimation.prototype.start = function(){
	this.bonfireSpriteId = 0;
	var bonFireAnimation = this;
	this.interval = setInterval(function(){
		bonFireAnimation.animate()}, 
		BonFireAnimation.ROLLOVER_TIME_INTERVAL);
};

BonFireAnimation.prototype.stop = function(){
	clearInterval(this.interval);
	var bonFireAnimation = this;
	_.each(this.coordinates, function(coordinate){
		bonFireAnimation.layer.clearRect(coordinate[0], coordinate[1], LevelAnimation.BONFIRE_IMAGE_WIDTH,LevelAnimation.BONFIRE_IMAGE_HEIGHT);
	});
};

BonFireAnimation.prototype.animate = function(){
	var image = this.bonfireImageSpriteSheet.getSprite([this.bonfireSpriteId, 0]);
	var bonFireAnimation = this;
	_.each(this.coordinates, function(coordinate){
		bonFireAnimation.layer.putImageData(image, coordinate[0], coordinate[1]);
	});
	this.bonfireSpriteId++;
	this.bonfireSpriteId = this.bonfireSpriteId % LevelAnimation.BONFIRE_SPRITE_MATRIX[0].length;
};

BombAnimation.ROLLOVER_TIME_INTERVAL=100;
function BombAnimation(coordinates, bombImageSpriteSheet, layer, callback){
	this.bombImageSpriteSheet = bombImageSpriteSheet;
	this.interval = null;
	this.bombSpriteId = 0;
	this.coordinates = coordinates;
	this.layer = layer;
	this.callback = callback;
}

BombAnimation.prototype.start = function(){
	this.bombSpriteId = 0;
	var bombAnimation = this;
	this.interval = setInterval(function(){
		bombAnimation.animate()}, 
		BombAnimation.ROLLOVER_TIME_INTERVAL);
};

BombAnimation.prototype.stop = function(){
	if(this.interval){
		clearInterval(this.interval);
		var bombAnimation = this;
		bombAnimation.layer.clearRect(this.coordinates[0], this.coordinates[1], this.imageWidth, this.imageHeight);
	}
};

BombAnimation.prototype.animate = function(){
	var image = this.bombImageSpriteSheet.getSprite([this.bombSpriteId, 0]);
	this.imageHeight = image.height;
	this.imageWidth = image.width;
	this.layer.putImageData(image, this.coordinates[0], this.coordinates[1]);
	this.bombSpriteId++;
	if(this.bombSpriteId >= this.bombImageSpriteSheet.spriteMatrix[0].length){
		this.callback(this.callback);
	}
};

//

GameStartArrowAnimation.ROLLOVER_TIME_INTERVAL=100;
function GameStartArrowAnimation(coordinates, imageSpriteSheet, layer ,callback){
	this.imageSpriteSheet = imageSpriteSheet;
	this.interval = null;
	this.spriteId = 0;
	this.coordinates = coordinates;
	this.layer = layer;
	this.callback = callback;
}

GameStartArrowAnimation.prototype.start = function(){
	this.spriteId = 0;
	var animation = this;
	this.interval = setInterval(function(){
		animation.animate()}, 
		GameStartArrowAnimation.ROLLOVER_TIME_INTERVAL);
};

GameStartArrowAnimation.prototype.stop = function(){
	if(this.interval){
		clearInterval(this.interval);
		var animation = this;
		animation.layer.clearRect(this.coordinates[0], this.coordinates[1], this.imageWidth, this.imageHeight);
	}
};

GameStartArrowAnimation.prototype.animate = function(){
	var image = this.imageSpriteSheet.getSprite([this.spriteId, 0]);
	this.imageHeight = image.height;
	this.imageWidth = image.width;
	this.layer.putImageData(image, this.coordinates[0], this.coordinates[1]);
	this.spriteId++;
	if(this.spriteId >= this.imageSpriteSheet.spriteMatrix[0].length-2){
		this.callback();
	}
};

NextLevelArrowAnimation.ROLLOVER_TIME_INTERVAL=330;
function NextLevelArrowAnimation(layer, arrowsInfo){
	this.layer = layer;
	this.arrowsInfo = arrowsInfo;
	this.interval = null;
	this.rolloverSpriteId = 0;
}

NextLevelArrowAnimation.prototype.start = function(){
	this.rolloverSpriteId = 0;
	var rolloverAnimation = this;
	this.interval = setInterval(function(){
		rolloverAnimation.animate(rolloverAnimation)}, 
		RolloverAnimation.ROLLOVER_TIME_INTERVAL);
};

NextLevelArrowAnimation.prototype.stop = function(){
	clearInterval(this.interval);
	var nextLevelArrowAnimation = this;
	var arrowsInfo = nextLevelArrowAnimation.arrowsInfo;
	_.each(arrowsInfo, function(arrowInfo){
		nextLevelArrowAnimation.layer.clearRect(arrowInfo.xCoord, arrowInfo.yCoord, arrowInfo.image.width, arrowInfo.image.height);	
	});
};

NextLevelArrowAnimation.prototype.animate = function(){
	var nextLevelArrowAnimation = this;
	var arrowsInfo = nextLevelArrowAnimation.arrowsInfo;
	_.each(arrowsInfo, function(arrowInfo){
		if(nextLevelArrowAnimation.rolloverSpriteId == 1){
			nextLevelArrowAnimation.layer.clearRect(arrowInfo.xCoord, arrowInfo.yCoord, arrowInfo.image.width, arrowInfo.image.height);	
		}else{
			nextLevelArrowAnimation.layer.drawImage(arrowInfo.image, arrowInfo.xCoord, arrowInfo.yCoord);
		}
	});
	this.rolloverSpriteId++;
	this.rolloverSpriteId = this.rolloverSpriteId % 2;
};

MakeMatchAnimation.ROLLOVER_TIME_INTERVAL=300;
MakeMatchAnimation.BORDER_COLOR = 'blue';
function MakeMatchAnimation(layer, initialTile, swapTile, rolloverImageSpriteSheet){
	this.layer = layer;
	this.initialTile = initialTile;
	this.swapTile = swapTile;
	this.rolloverSpriteId = 0;
	this.rolloverImageSpriteSheet = rolloverImageSpriteSheet;
	this.tileActive = null;
}

MakeMatchAnimation.prototype.start = function(){
	this.rolloverSpriteId = 0;
	var makeMatchAnimation = this;
	this.interval = setInterval(function(){
		makeMatchAnimation.animate()}, 
		MakeMatchAnimation.ROLLOVER_TIME_INTERVAL);
};

MakeMatchAnimation.prototype.stop = function(){
	this.layer.clearRect(this.initialTile.getXCoord(), this.initialTile.getYCoord(),Tile.getWidth(), Tile.getHeight());
	this.layer.drawImage(this.initialTile.blob.image, this.initialTile.getXCoord(),this.initialTile.getYCoord(), Tile.getWidth(), Tile.getHeight());
	this.layer.clearRect(this.swapTile.getXCoord(), this.swapTile.getYCoord(),Tile.getWidth(), Tile.getHeight());
	this.layer.drawImage(this.swapTile.blob.image, this.swapTile.getXCoord(),this.swapTile.getYCoord(), Tile.getWidth(), Tile.getHeight());
	clearInterval(this.interval);
};

MakeMatchAnimation.prototype.animate = function(){
	if(this.rolloverSpriteId == 0){
		if(this.tileActive){
			this.layer.clearRect(this.tileActive.getXCoord(), this.tileActive.getYCoord(),Tile.getWidth(), Tile.getHeight());
			this.layer.drawImage(this.tileActive.blob.image, this.tileActive.getXCoord(),this.tileActive.getYCoord(), Tile.getWidth(), Tile.getHeight());
		}
		if(this.tileActive == this.initialTile){
			this.tileActive = this.swapTile;
		}else{
			this.tileActive = this.initialTile;
		}
		
	}
	var image = this.rolloverImageSpriteSheet.getSpriteNew([this.rolloverSpriteId, 0]);
	this.layer.clearRect(this.tileActive.getXCoord(), this.tileActive.getYCoord(),Tile.getWidth(), Tile.getHeight());
	this.layer.drawImage(this.tileActive.blob.image, this.tileActive.getXCoord(),this.tileActive.getYCoord(), Tile.getWidth(), Tile.getHeight());
	this.layer.drawImage(image, this.tileActive.getXCoord(), this.tileActive.getYCoord(), Tile.getWidth(), Tile.getHeight());
	this.rolloverSpriteId++;
	this.rolloverSpriteId = this.rolloverSpriteId % this.rolloverImageSpriteSheet.spriteMatrix[0].length;
};

