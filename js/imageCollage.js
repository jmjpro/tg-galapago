ImageCollage.COLLAGE_ARRAY = [
	{
		'collageId': 'collage/main-menu-1.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 305, 60], 'id': 'main-menu/button-change-player-selected.png'},
			{'cell': [0, 60, 305, 60], 'id': 'main-menu/button-change-player-regular.png'},
			{'cell': [305, 0, 165, 60], 'id': 'main-menu/button-options-selected.png'},
			{'cell': [305, 60, 165, 60], 'id': 'main-menu/button-options-regular.png'}
		]
	},
	{
		'collageId': 'collage/main-menu-2.png',
		'imageCoordinateArray': [
			/*{'cell': [0, 120, 233, 164], 'id': 'main-menu/button-timed-selected.png'},*/
			{'cell': [0, 0, 234, 164], 'id': 'main-menu/button-timed-regular.png'},
			{'cell': [0, 164, 234, 164], 'id': 'main-menu/button-relaxed-selected.png'},
			{'cell': [0, 328, 234, 164], 'id': 'main-menu/button-relaxed-regular.png'}
		]
	},
	{
		'collageId': 'collage/arrows.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 25, 25], 'id': 'main-menu/arrow-left.png'},
			{'cell': [0, 25, 25, 25], 'id': 'main-menu/arrow-right.png'}
		]
	},
	{
		'collageId': 'collage/dialog-buttons.png',
		'imageCoordinateArray': [
			{'cell': [0,0,358,60], 'id': 'dialog/button_large_narrow_regular.png'},
			{'cell': [0,29,388,90], 'id': 'dialog/button_large_narrow_highlighted.png'},
			{'cell': [0,75,175,40], 'id': 'dialog/button-huge.png'},
			{'cell': [10,128,175,40], 'id': 'dialog/button-huge-hilight.png'},
			{'cell': [0,172,78,24], 'id': 'dialog/button_medium_regular.png'},
			{'cell': [0,201,78,22], 'id': 'dialog/button_medium_disabled.png'},
			{'cell': [11,238,78,22], 'id': 'dialog/button-medium-hilight.png'},
			{'cell': [0,269,164,85], 'id': 'dialog/button_game_menu_regular.png'},
			{'cell': [0,312,190,110], 'id': 'dialog/button_game_menu_highlighted.png'},
			{'cell': [0,367,98,61], 'id': 'dialog/button_small_regular.png'},
			{'cell': [0,397,128,87], 'id': 'dialog/button_small_highlighted.png'}
		]
	},
	{
		'collageId': 'collage/dialog-arrow-buttons.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 1, 1], 'id': 'dialog/arrow-button-1.png'},
		]
	},
	{
		'collageId': 'collage/keypad-buttons.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 1, 1], 'id': 'dialog/keypad-button-1.png'},
		]
	},
	{
		'collageId': 'collage/map-board-1.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 40, 43], 'id': 'screen-map/level-stars-silver.png'},
			{'cell': [40, 0, 40, 43], 'id': 'screen-map/level-stars-gold.png'},
			{'cell': [80, 0, 40, 35], 'id': 'screen-map/green-v.png'},
			{'cell': [120, 0, 29, 34], 'id': 'screen-map/level-lock.png'},
			{'cell': [149, 0, 24, 52], 'id': 'screen-game/bracket-left.png'},
			{'cell': [173, 0, 24, 52], 'id': 'screen-game/bracket-right.png'}
		]
	},
	{
		'collageId': 'collage/map-board-2.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 19, 284], 'id': 'screen-game/powerups-holder.png'},
			{'cell': [19, 0, 38, 26], 'id': 'screen-map/next-level-arrow-down.png'},
			{'cell': [19, 26, 38, 24], 'id': 'screen-map/next-level-arrow-left-down.png'},
			{'cell': [19, 50, 38, 24], 'id': 'screen-map/next-level-arrow-right-down.png'},
			{'cell': [19, 74, 30, 24], 'id': 'screen-map/next-level-arrow-left-up.png'},
			{'cell': [19, 98, 30, 24], 'id': 'screen-map/next-level-arrow-right-up.png'},
			{'cell': [19, 122, 34, 25], 'id': 'screen-map/next-level-arrow-left.png'},
			{'cell': [19, 147, 34, 25], 'id': 'screen-map/next-level-arrow-right.png'},
			{'cell': [19, 172, 27, 22], 'id': 'screen-map/next-level-arrow-up.png'},
			{'cell': [57, 0, 56, 56], 'id': 'screen-game/tile-active.png'},
			{'cell': [57, 56, 52, 52], 'id': 'screen-game/tile-selected.png'},
			{'cell': [57, 108, 46, 46], 'id': 'screen-game/tile-regular.png'},
			{'cell': [57, 154, 41, 33], 'id': 'screen-game/item-collected-mark.png'}
		]
	},
	{
		'collageId': 'collage/map-board-buttons.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 150, 55], 'id': 'screen-map/button-regular.png'},
			{'cell': [150, 0, 150, 55], 'id': 'screen-map/button-cursor.png'}
		]
	},
	{
		'collageId': 'collage/game-powerup.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 35, 35], 'id': 'screen-game/flame-disabled.png'},
			{'cell': [0, 35, 19, 19], 'id': 'screen-game/flame-fill.png'},
			{'cell': [35, 0, 35, 35], 'id': 'screen-game/swap-disabled.png'},
			{'cell': [19, 35, 19, 19], 'id': 'screen-game/swap-fill.png'},
			{'cell': [70, 0, 35, 35], 'id': 'screen-game/shuffle-disabled.png'},
			{'cell': [38, 35, 19, 19], 'id': 'screen-game/shuffle-fill.png'}
		]
	},
	{
		'collageId': 'collage/gold-strip.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 46, 46], 'id': 'screen-game/gold/gold-1.png'}
		]
	},
	{
		'collageId': 'collage/heads-eyes-strip.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 552, 21], 'id': 'screen-game/heads-right-eyes-strip.png'},
			{'cell': [0, 21, 481, 21], 'id': 'screen-game/heads-left-eyes-strip.png'}
		]
	},
	{
		'collageId': 'collage/game-beach-jump-strips.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 340, 92], 'id': 'creatures/beach/blue-crab-jump-strip.png'},
			{'cell': [0, 92, 340, 92], 'id': 'creatures/beach/green-turtle-jump-strip.png'},
			{'cell': [0, 184, 340, 92], 'id': 'creatures/beach/pink-frog-jump-strip.png'},
			{'cell': [0, 276, 340, 92], 'id': 'creatures/beach/red-starfish-jump-strip.png'},
			{'cell': [0, 368, 340, 92], 'id': 'creatures/beach/teal-blob-jump-strip.png'},
			{'cell': [0, 460, 340, 92], 'id': 'creatures/beach/violet-crab-jump-strip.png'},
			{'cell': [0, 552, 340, 92], 'id': 'creatures/beach/yellow-fish-jump-strip.png'},
		]
	},
	{
		'collageId': 'collage/game-beach-rollover-strips.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 230, 46], 'id': 'creatures/beach/blue-crab-rollover-strip.png'},
			{'cell': [0, 46, 230, 46], 'id': 'creatures/beach/green-turtle-rollover-strip.png'},
			{'cell': [0, 92, 230, 46], 'id': 'creatures/beach/pink-frog-rollover-strip.png'},
			{'cell': [0, 138, 230, 46], 'id': 'creatures/beach/red-starfish-rollover-strip.png'},
			{'cell': [0, 184, 230, 46], 'id': 'creatures/beach/teal-blob-rollover-strip.png'},
			{'cell': [0, 230, 230, 46], 'id': 'creatures/beach/violet-crab-rollover-strip.png'},
			{'cell': [0, 276, 230, 46], 'id': 'creatures/beach/yellow-fish-rollover-strip.png'}
		]
	},
	{
		'collageId': 'collage/game-forest-jump-strips.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 260, 92], 'id': 'creatures/forest/blue-beetle-jump-strip.png'},
			{'cell': [0, 92, 260, 92], 'id': 'creatures/forest/green-butterfly-jump-strip.png'},
			{'cell': [0, 184, 260, 92], 'id': 'creatures/forest/pink-lizard-jump-strip.png'},
			{'cell': [0, 276, 260, 92], 'id': 'creatures/forest/red-beetle-jump-strip.png'},
			{'cell': [0, 368, 260, 92], 'id': 'creatures/forest/teal-bug-jump-strip.png'},
			{'cell': [0, 460, 260, 92], 'id': 'creatures/forest/violet-moth-jump-strip.png'},
			{'cell': [0, 552, 260, 92], 'id': 'creatures/forest/yellow-frog-jump-strip.png'}
		]
	},
	{
		'collageId': 'collage/game-forest-rollover-strips.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 230, 46], 'id': 'creatures/forest/blue-beetle-rollover-strip.png'},
			{'cell': [0, 46, 230, 46], 'id': 'creatures/forest/green-butterfly-rollover-strip.png'},
			{'cell': [0, 92, 230, 46], 'id': 'creatures/forest/pink-lizard-rollover-strip.png'},
			{'cell': [0, 138, 230, 46], 'id': 'creatures/forest/red-beetle-rollover-strip.png'},
			{'cell': [0, 184, 230, 46], 'id': 'creatures/forest/teal-bug-rollover-strip.png'},
			{'cell': [0, 230, 230, 46], 'id': 'creatures/forest/violet-moth-rollover-strip.png'},
			{'cell': [0, 276, 230, 46], 'id': 'creatures/forest/yellow-frog-rollover-strip.png'}
		]
	},
	{
		'collageId': 'collage/game-cave-jump-strips.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 350, 92], 'id': 'creatures/cave/blue-crystal-jump-strip.png'},
			{'cell': [0, 92, 350, 92], 'id': 'creatures/cave/green-frog-jump-strip.png'},
			{'cell': [0, 184, 350, 92], 'id': 'creatures/cave/pink-spike-jump-strip.png'},
			{'cell': [0, 276, 350, 92], 'id': 'creatures/cave/red-beetle-jump-strip.png'},
			{'cell': [0, 368, 350, 92], 'id': 'creatures/cave/teal-flyer-jump-strip.png'},
			{'cell': [0, 460, 350, 92], 'id': 'creatures/cave/violet-lizard-jump-strip.png'},
			{'cell': [0, 552, 350, 92], 'id': 'creatures/cave/yellow-bug-jump-strip.png'}
		]
	},
	{
		'collageId': 'collage/game-cave-rollover-strips.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 230, 46], 'id': 'creatures/cave/blue-crystal-rollover-strip.png'},
			{'cell': [0, 46, 230, 46], 'id': 'creatures/cave/green-frog-rollover-strip.png'},
			{'cell': [0, 92, 230, 46], 'id': 'creatures/cave/pink-spike-rollover-strip.png'},
			{'cell': [0, 138, 230, 46], 'id': 'creatures/cave/red-beetle-rollover-strip.png'},
			{'cell': [0, 184, 230, 46], 'id': 'creatures/cave/teal-flyer-rollover-strip.png'},
			{'cell': [0, 230, 230, 46], 'id': 'creatures/cave/violet-lizard-rollover-strip.png'},
			{'cell': [0, 276, 230, 46], 'id': 'creatures/cave/yellow-bug-rollover-strip.png'}
		]
	},
	{
		'collageId': 'collage/superfriends.png',
		'imageCoordinateArray': [
			{'cell': [0, 0, 46, 46], 'id': 'screen-game/superfriends/blue.png'},
			{'cell': [0, 46, 46, 46], 'id': 'screen-game/superfriends/green.png'},
			{'cell': [0, 92, 46, 46], 'id': 'screen-game/superfriends/pink.png'},
			{'cell': [0, 138, 46, 46], 'id': 'screen-game/superfriends/red.png'},
			{'cell': [0, 184, 46, 46], 'id': 'screen-game/superfriends/teal.png'},
			{'cell': [0, 230, 46, 46], 'id': 'screen-game/superfriends/violet.png'},
			{'cell': [0, 276, 46, 46], 'id': 'screen-game/superfriends/yellow.png'}
		]
	}
];

// assumes a sheet of symmetric images defined by a 1 or 2 dimensional image matrix
function ImageCollage(collageDescriptor){
	this.collageId = collageDescriptor.collageId;
	this.imageCoordinateArray = collageDescriptor.imageCoordinateArray;

	var i, id, loadedImages = LoadingScreen.gal.getLoadedImages(this.collageId);
	if(loadedImages) {
		for(i = 0; i < collageDescriptor.imageCoordinateArray.length; i++) {
			id = collageDescriptor.imageCoordinateArray[i].id;
			this.imageCache[id] = loadedImages[id];
		}
	} else {
		this.image = LoadingScreen.gal.get(this.collageId);
		this._canvas = document.createElement('canvas');
		this._canvas.style.display = 'none';
		this._canvas.style.position = 'absolute';
		this._canvas.style.left = -1000;
		this._canvas.style.top = -1000;
		this._ctx = this._canvas.getContext('2d');

		this.imageCache = {};
		for(i = 0; i < collageDescriptor.imageCoordinateArray.length; i++) {
			id = collageDescriptor.imageCoordinateArray[i].id;
			this.imageCache[id] = this.getImageForCache(id);
		}

		this._ctx = null;
		this._canvas.width = 1;
		this._canvas.height = 1;
		this._canvas = null;
		this.image = null;

		LoadingScreen.gal.setLoadedImages(this.collageId, this.imageCache);
		LoadingScreen.gal.set(this.collageId, null);
	}

	//this.collageId = null;
} // ImageCollage constructor

//return an array of image objects corresponding to the rectangular regions in the this.coordinateArray
ImageCollage.prototype.getImage = function (imageId){
	return this.imageCache[imageId];
 }; // ImageCollage.prototype.getImage()

ImageCollage.prototype.getImageForCache = function (imageId){
	var imageCollage, imageCoordinate, image, x, y, width, height;
	imageCollage = this;
	imageCoordinate = _.find( this.imageCoordinateArray,{'id' : imageId} );
	x = imageCoordinate.cell[0];
	y = imageCoordinate.cell[1];
	width = imageCoordinate.cell[2];
	height = imageCoordinate.cell[3];
	imageCollage._canvas.width = width;
	imageCollage._canvas.height = height;
	console.log(width + "," + height + "," + x + "," + y + "," + imageCollage.image.naturalWidth);
	if(x + width > imageCollage.image.naturalWidth) {
		if(imageCollage.image.naturalWidth >= width) {
			x = imageCollage.image.naturalWidth - width;
		} else {
			x = 0;
			width = imageCollage.image.naturalWidth;
		}
	}
	if(y + height > imageCollage.image.naturalHeight) {
		if(imageCollage.image.naturalHeight >= height) {
			y = imageCollage.image.naturalHeight - height;
		} else {
			y = 0;
			height = imageCollage.image.naturalHeight;
		}
	}
	imageCollage._ctx.drawImage(imageCollage.image, x, y, width, height, 0, 0, width, height);
	image = new Image();
	image.src = imageCollage._canvas.toDataURL("image/png");
	image.id = imageCoordinate.id;
	return image;
}; //ImageCollage.prototype.getImage()

//return an array of image objects corresponding to the rectangular regions in the this.coordinateArray
ImageCollage.prototype.getImages = function (){
	var imageCollage, imageArray;
	imageCollage = this;
	imageArray = [];
	_.each( this.imageCoordinateArray, function( imageCoordinate ){
		imageArray.push( imageCollage.getImage(imageCoordinate.id) );
	});
	return imageArray;
}; //ImageCollage.prototype.getImages()

ImageCollage.loadByName = function (collageId){
	var imageCollage, collageDescriptor;
	/*console.debug( 'collageId: ' + collageId );*/
	collageDescriptor = _.find( ImageCollage.COLLAGE_ARRAY, function( collageDescriptor ){
		if( collageDescriptor.collageId === collageId ){
			return collageDescriptor;
		}
	});
	imageCollage = new ImageCollage(collageDescriptor);
	return imageCollage;
}; //ImageCollage.loadByName()